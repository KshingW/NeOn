<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Affine Optimization for Image Registration</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            color: #24292e;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .author-list {
            text-align: center;
            margin: 20px 0;
            font-size: 1.1em;
        }
        .affiliations {
            text-align: center;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 20px;
        }
        .image-container {
            width: 100%;
            margin: 20px auto;
            text-align: center;
        }
        
        .image-container.large {
            width: 100%;
            max-width: 1000px;
        }
        
        .image-container.medium {
            width: 80%;
            max-width: 800px;
        }
        
        .image-container.small {
            width: 60%;
            max-width: 600px;
        }
        
        .image-container img {
            width: 100%;
            height: auto;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            display: block;
            margin: 0 auto;
        }
        .caption {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            text-align: justify;
        }
        h1, h2, h3 {
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }
        .links {
            text-align: center;
            margin: 20px 0;
        }
        .button {
            display: inline-block;
            padding: 8px 16px;
            margin: 0 8px;
            background: #0366d6;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .button:hover {
            background: #0255b3;
        }
        pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
        }
        .highlight-box {
            background: #f8f9fa;
            border-left: 4px solid #0366d6;
            padding: 16px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Neural Affine Optimization for Image Registration</h1>
        
        <div class="author-list">
            Hang Zhang, Jiacheng Wang, Xiang Chen, Renjiu Hu, Min Liu, Yaonan Wang, Rongguang Wang, Jinming Duan, Noel Codella
        </div>
        
        <div class="affiliations">
            Cornell University | Vanderbilt University | Hunan University | University of Pennsylvania | University of Manchester | Microsoft
        </div>
        
        <div class="links">
            <a href="#" class="button">Paper</a>
            <a href="https://github.com/KshingW/NeOn/tree/main" class="button">Code</a>
            <a href="#" class="button">IEEE TMI 2024</a>
        </div>
    </div>

    <h2>Abstract</h2>
    <div class="highlight-box">
        Affine registration is crucial in medical image analysis but faces challenges when matching sparse features, such as retinal vessels and filamentous collagen fibers in second-harmonic generation (SHG) and bright-field (BF) images. End-to-end learning-based approaches struggle with minimal effective gradients from loss back-propagation of these sparse features, while descriptor matching methods, though helpful, lack fidelity loss and leave the matching process open-looped. To address these issues, we propose Neural Affine Optimization (NeOn), which implicitly approximates discrete optimization using a few neural network layers, combined with a sampling-regression layer to handle affine transformations. NeOn allows iterative refinement with fidelity loss and provides a flexible transition between a purely affine configuration and a linear weighted blend of affine and deformation fields.
    </div>

<h2>Demo: Deformation Change Among Iterations</h2>

<!-- Example 1 -->
<div style="margin-bottom: 40px;">
    <h3>Example 1: Retinal Vessel Alignment</h3>
    <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 20px;">
        <!-- GIF Section -->
        <div style="flex: 1; min-width: 300px;">
            <img src="./static/gifs/A02_video.gif" alt="Deformation Change GIF - Example 1" style="width: 100%; height: auto; border: 1px solid #e1e4e8; border-radius: 6px;">
            <div class="caption">
                Moving Image deformable change over time.
            </div>
        </div>

        <!-- Static Image Section -->
        <div style="flex: 1; min-width: 300px;">
            <img src="./static/images/A02_2.jpg" alt="Static Deformation Visualization - Example 1" style="width: 100%; height: auto; border: 1px solid #e1e4e8; border-radius: 6px;">
            <div class="caption">
		Fixed Image.
            </div>
        </div>
    </div>
</div>

<!-- Example 2 -->
<div style="margin-bottom: 40px;">
    <h3>Example 2: SHG-BF Image Alignment</h3>
    <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 20px;">
        <!-- GIF Section -->
        <div style="flex: 1; min-width: 300px;">
            <img src="./static/gifs/P35_video.gif" alt="Deformation Change GIF - Example 2" style="width: 100%; height: auto; border: 1px solid #e1e4e8; border-radius: 6px;">
            <div class="caption">
                Moving Image deformable change over time.
            </div>
        </div>

        <!-- Static Image Section -->
        <div style="flex: 1; min-width: 300px;">
            <img src="./static/images/P35_2.jpg" alt="Static Deformation Visualization - Example 2" style="width: 100%; height: auto; border: 1px solid #e1e4e8; border-radius: 6px;">
            <div class="caption">
                Fixed Image.
            </div>
        </div>
    </div>
</div>



<h2>Problem Statement</h2>
    <div class="image-container medium">
        <img src="./static/images/sparse_gradients.png" alt="Gradient Backflow Limitation">
        <div class="caption">
            Visual illustration of the issue of limited gradient backflow. The comparison shows retinal vessel and SHG images with their corresponding horizontal translation differences, highlighting areas where loss gradient can be effectively back-propagated.
        </div>
    </div>

       <h2>Method</h2>
    <div class="image-container small">
        <img src="./static/images/neon_framework.png" alt="NeOn Framework">
        <div class="caption">
            The proposed Neural Affine Optimization (NeOn) framework. Our method combines neural network layers with a sampling-regression approach for handling affine transformations.
        </div>
    </div>



    <h2>Datasets</h2>
    <div class="highlight-box">
        <h3>FIRE Dataset</h3>
        <p>Mono-modal retinal vessel dataset with 39 subjects and 134 image pairs (2912×2912 pixels, 45° FOV)</p>
        
        <h3>CF-FA Dataset</h3>
        <p>Multi-modal diabetic retinal dataset with 59 subjects, combining Fractional Anisotropy and Color Fundus images (720×576 pixels)</p>
        
        <h3>SHG-BF Dataset</h3>
        <p>Learn2Reg Challenge 2024 Task 3 dataset with 10 image pairs, combining Bright Field microscopy with Second Harmonic Generation imaging</p>
    </div>

    <h2>Results</h2>
    <div class="./static/images/image-container large">
        <img src="./static/images/qualitative_fire_resized.png" alt="Qualitative Results">
        <div class="caption">
            Qualitative comparison of registration results on the FIRE dataset, demonstrating NeOn's superior performance in handling sparse features.
        </div>
    </div>
    For the quantitative comparison, please refer to the details in the orignal paper.

   <h2>Implementation</h2>
    <div class="highlight-box">
        <h3>FIRE Dataset</h3>
        <ol>
            <li>Feature Extraction:
                <ul>
                    <li>Use LWNet (<a href="https://github.com/agaldran/lwnet">GitHub</a>) to extract vessel features</li>
                    <li>Store extracted features in 'FIRE_cnn' folder</li>
                </ul>
            </li>
            <li>Run Optimization:
                <pre>python test_neon_fire.py --ori_size '(2912,2912)' --img_size '(1024,1024)' temp=0.001 ks=1 alpha=1</pre>
                Parameters:
                <ul>
                    <li><code>ori_size</code>: Original image dimensions</li>
                    <li><code>img_size</code>: Input image size for processing</li>
                    <li><code>temp</code>: Temperature parameter</li>
                    <li><code>ks</code>: Kernel size</li>
                    <li><code>alpha</code>: Blending parameter</li>
                </ul>
            </li>
        </ol>

        <h3>CF-FA Dataset</h3>
        <ol>
            <li>Feature Extraction:
                <ul>
                    <li>For fundus images: Use LWNet (<a href="https://github.com/agaldran/lwnet">GitHub</a>)</li>
                    <li>For FA images: Use DeepVesselSeg4FA (<a href="https://github.com/ShamaLabUR/DeepVesselSeg4FA">GitHub</a>)</li>
                    <li>Store all features in 'CFFA_cnn' folder</li>
                </ul>
            </li>
            <li>Run Optimization:
                <pre>python test_neon_cffa.py --ori_size '(576,720)' --img_size '(576,720)' temp=0.001 ks=1 alpha=1</pre>
            </li>
        </ol>

        <h3>SHG-BF Dataset</h3>
        <ol>
            <li>Feature Extraction Training:
                <ul>
                    <li>We provide contrastive-based COMIR feature extraction with XFeat prealignment</li>
                    <pre>python train_shgbf.py -m tiramisuAndXfeatComplex111Msk1Ps128 -bs 1 --gpu_id 0 \
    ti_pretrained=1 enable_grad_xfeat=1 xf_pretrained=1 --is_msk 1 --patch_size 128</pre>
                </ul>
            </li>
            <li>Run Optimization:
                <pre>python test_neon_shgbf.py -m tiramisuAndXfeatComplex -bs 1 --gpu_id 0 --load_ckpt none --is_first_half 1</pre>
            </li>
        </ol>
    </div>


    <h2>Citation</h2>
    <pre>
@article{zhang2024neural,
    title={Neural Affine Optimization for Image Registration},
    author={Zhang, Hang and Wang, Jiacheng and Chen, Xiang and Hu, Renjiu and Liu, Min and 
            Wang, Yaonan and Wang, Rongguang and Duan, Jinming and Codella, Noel},
    journal={IEEE Transactions on Medical Imaging},
    year={2024}
}

@article{wang2024fidelity,
    title={Fidelity-Imposed Displacement Editing for the Learn2Reg 2024 SHG-BF Challenge},
    author={Wang, Jiacheng and Chen, Xiang and Hu, Renjiu and Wang, Rongguang and Liu, Min and 
            Wang, Yaonan and Wang, Jiazheng and Li, Hao and Zhang, Hang},
    journal={arXiv preprint arXiv:2410.20812},
    year={2024}
}</pre>

</body>
</html>
